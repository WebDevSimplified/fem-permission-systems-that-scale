<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/fem-permission-systems-that-scale/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/fem-permission-systems-that-scale/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/fem-permission-systems-that-scale/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/fem-permission-systems-that-scale/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/fem-permission-systems-that-scale/images/favicon.ico" data-next-head=""/><title data-next-head="">Clean Architecture: The Services Layer â€“ Permission Systems that Scale</title><meta name="description" content="Learn how to implement robust permission systems in your web applications. Master RBAC, ABAC, field-level permissions, and build your own authorization engine from scratch using TypeScript." data-next-head=""/><meta name="keywords" content="Permissions,Authorization,RBAC,ABAC,Access Control,TypeScript,Security,CASL,Web Dev Simplified,Frontend Masters" data-next-head=""/><meta name="og:description" content="Learn how to implement robust permission systems in your web applications. Master RBAC, ABAC, field-level permissions, and build your own authorization engine from scratch using TypeScript." data-next-head=""/><meta name="og:title" content="Clean Architecture: The Services Layer â€“ Permission Systems that Scale" data-next-head=""/><meta name="og:image" content="/fem-permission-systems-that-scale/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/fem-permission-systems-that-scale/_next/static/css/3e2d260a483e4ce6.css" as="style"/><link rel="stylesheet" href="/fem-permission-systems-that-scale/_next/static/css/3e2d260a483e4ce6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/fem-permission-systems-that-scale/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/webpack-561d6b920ac5fc2e.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/main-8377b0572add80b6.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/pages/_app-ab9f88be91011ccd.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-c23b0a3ff434a742.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/Z1s-VsOExbnNujkBZEKnx/_buildManifest.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/Z1s-VsOExbnNujkBZEKnx/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/fem-permission-systems-that-scale">Permission Systems that Scale</a></h1><div class="navbar-info"></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>Our ABAC system works, but authorization logic is scattered everywhere. Let&#39;s fix that by introducing a <strong>services layer</strong> that centralizes all permission checks.</p>
<h2>The Problem</h2>
<p>Currently, auth checks live in multiple places:</p>
<pre><code class="hljs language-text"><button class="copy-btn">Copy</button>ğŸ“ src/
â”œâ”€â”€ ğŸ“ actions/
â”‚   â”œâ”€â”€ documents.ts    â† Auth checks here
â”‚   â””â”€â”€ projects.ts     â† Auth checks here
â”œâ”€â”€ ğŸ“ dal/
â”‚   â””â”€â”€ documents.ts    â† And here
â””â”€â”€ ğŸ“ app/
    â””â”€â”€ (pages)/
        â”œâ”€â”€ documents/  â† And here too!
        â””â”€â”€ projects/
</code></pre><p>This creates problems:</p>
<ol>
<li><strong>Duplication</strong> - Same checks written multiple ways</li>
<li><strong>Inconsistency</strong> - Easy to forget a check somewhere</li>
<li><strong>Difficult testing</strong> - Auth logic tied to framework code</li>
<li><strong>Performance</strong> - Potentially extra database queries</li>
</ol>
<h2>The Solution: Services Layer</h2>
<p>We&#39;ll create a dedicated layer for business logic which includes authorization checks:</p>
<pre><code class="hljs language-text"><button class="copy-btn">Copy</button>ğŸ“ src/
â”œâ”€â”€ ğŸ“ services/        â† NEW: All auth lives here
â”‚   â”œâ”€â”€ documents.ts
â”‚   â””â”€â”€ projects.ts
â”œâ”€â”€ ğŸ“ actions/         â† Just validates &amp; calls services
â”œâ”€â”€ ğŸ“ dal/             â† Just database access
â””â”€â”€ ğŸ“ app/             â† Just UI concerns
</code></pre><h2>A Basic Service</h2>
<p>The key to our service layer is that each function in this layer should take into account all authorization checks and only return data the user has access to. This centralizes authorization logic and ensures consistency across the application.</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createDocumentService</span>(<span class="hljs-params">
  <span class="hljs-attr">projectId</span>: <span class="hljs-built_in">string</span>,
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">DocumentFormValues</span>,
</span>) {
  <span class="hljs-comment">// Step 1: Authentication - who is making this request?</span>
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getCurrentUser</span>()
  <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Unauthenticated&quot;</span>)

  <span class="hljs-comment">// Step 2: Authorization - can they perform this action?</span>
  <span class="hljs-keyword">const</span> permissions = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserPermissions</span>()
  <span class="hljs-keyword">if</span> (!permissions.<span class="hljs-title function_">can</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;create&quot;</span>)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthorizationError</span>()

  <span class="hljs-comment">// Step 3: Field filtering - only allow permitted fields</span>
  <span class="hljs-keyword">const</span> restrictedData = permissions.<span class="hljs-title function_">pickPermittedFields</span>(
    <span class="hljs-string">&quot;document&quot;</span>,
    <span class="hljs-string">&quot;create&quot;</span>,
    data,
  )

  <span class="hljs-comment">// Step 4: Validation - is the data valid?</span>
  <span class="hljs-keyword">const</span> result = documentSchema.<span class="hljs-title function_">safeParse</span>(restrictedData)
  <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">success</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Invalid data&quot;</span>)

  <span class="hljs-comment">// Step 5: Execute - perform the actual operation</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">createDocument</span>({
    ...result.<span class="hljs-property">data</span>,
    <span class="hljs-attr">creatorId</span>: user.<span class="hljs-property">id</span>,
    <span class="hljs-attr">lastEditedById</span>: user.<span class="hljs-property">id</span>,
    projectId,
  })
}
</code></pre><p>In the above example we are checking the user&#39;s permission to create a document and ensuring only the fields they are allowed to modify are used for the creation. This centralizes authorization logic and prevents unauthorized field modifications.</p>
<p>Our action is now a simple wrapper that calls this service function and handles any errors or responses appropriately:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createDocumentAction</span>(<span class="hljs-params">
  <span class="hljs-attr">projectId</span>: <span class="hljs-built_in">string</span>,
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">DocumentFormValues</span>,
</span>) {
  <span class="hljs-keyword">const</span> [error, <span class="hljs-variable language_">document</span>] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">tryFn</span>(<span class="hljs-function">() =&gt;</span>
    <span class="hljs-title function_">createDocumentService</span>(projectId, data),
  )

  <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span> error

  <span class="hljs-title function_">redirect</span>(<span class="hljs-string">`/projects/<span class="hljs-subst">${projectId}</span>/documents/<span class="hljs-subst">${<span class="hljs-variable language_">document</span>.id}</span>`</span>)
}
</code></pre><p>Notice what&#39;s <strong>not</strong> in the action:</p>
<ul>
<li>No <code>if (!canUpdate)</code> checks</li>
<li>No manual field filtering</li>
<li>No permission imports</li>
</ul>
<p>All that complexity lives in the service.</p>
<h2>Refactoring Page Components</h2>
<p>Pages delegate to services and no longer include any direct permission checks:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProjectDocumentsPage</span>(<span class="hljs-params">{
  params,
}: <span class="hljs-title class_">PageProps</span>&lt;<span class="hljs-string">&quot;/projects/[projectId]&quot;</span>&gt;</span>) {
  <span class="hljs-keyword">const</span> { projectId } = <span class="hljs-keyword">await</span> params

  <span class="hljs-comment">// Returns null if not found or not authorized</span>
  <span class="hljs-keyword">const</span> project = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getProjectByIdService</span>(projectId)
  <span class="hljs-keyword">if</span> (project == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">notFound</span>()

  <span class="hljs-comment">// Only fetch documents the user is authorized to see</span>
  <span class="hljs-keyword">const</span> documents = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getProjectDocumentsService</span>(projectId)

  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// UI</span>
  )
}
</code></pre><h2>Architecture Benefits</h2>
<h3>1. Single Responsibility</h3>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Responsibility</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Pages</strong></td>
<td>Routing, layout, calling services</td>
</tr>
<tr>
<td><strong>Actions</strong></td>
<td>Form handling, validation, revalidation</td>
</tr>
<tr>
<td><strong>Services</strong></td>
<td>Business logic, authorization</td>
</tr>
<tr>
<td><strong>DAL</strong></td>
<td>Pure database operations</td>
</tr>
</tbody></table>
<p>This is very important since now you can use the data access layer to get data without having to worry about authorization logic or user context since many times in your application you may want to get all records regardless of the current user&#39;s permissions for specific business logic.</p>
<h3>2. Testability</h3>
<p>Since our data access layer, actions, and ui are no longer tied to the user or permissions we can easily test those layers in isolation. It is also easier to test our authorization logic since it all lives in one place.</p>
<h3>3. Security by Default</h3>
<p>As long as all calls go through the service layer it is impossible to accidentally bypass authorization checks or incorrectly code an authorization check since it is all handled automatically by the services layer.</p>
<h3>4. Efficient Queries</h3>
<p>By converting our auth permissions to a database query we are able to leverage the database&#39;s query engine to efficiently filter results based on the user&#39;s permissions, rather than fetching all data and filtering in application code.</p>
<h2>Converting Permissions to Database Queries</h2>
<p>The key insight is that ABAC conditions can become <code>WHERE</code> clauses:</p>
<p><img src="/fem-permission-systems-that-scale/images/04-abac/abac-to-sql.svg" alt="ABAC to SQL"></p>
<p>This can get complicated when dealing with multiple conditions and various combinations of permissions, but once you get the base layer down adding new conditions is pretty simple.</p>
<p>This is powerful because:</p>
<ul>
<li>We only fetch data the user can see</li>
<li>The database does the filtering (efficient!)</li>
<li>No chance of data leaks from forgetting a filter</li>
</ul>
<h2>Live Coding Exercise</h2>
<p>We&#39;ll refactor the codebase to:</p>
<ol>
<li>Create <code>src/services/documents.ts</code> and <code>src/services/projects.ts</code></li>
<li>Implement <code>toDrizzleWhere()</code> for automatic query generation</li>
<li>Refactor actions to use services</li>
<li>Update page components to use services</li>
<li>Remove auth code from actions and DAL</li>
</ol>
<h2>Branch Checkpoint</h2>
<p>After completing this lesson, your code should match:</p>
<pre><code class="hljs language-bash"><button class="copy-btn">Copy</button>git checkout 6-abac-advanced
</code></pre><h2>Summary</h2>
<p>The services layer pattern:</p>
<ul>
<li><strong>Centralizes</strong> all authorization in one place</li>
<li><strong>Converts</strong> ABAC conditions to database queries</li>
<li><strong>Simplifies</strong> actions and components</li>
<li><strong>Enables</strong> easy testing of permissions</li>
<li><strong>Prevents</strong> data leaks by filtering at the query level</li>
</ul>
<p>Our ABAC implementation is now:</p>
<ul>
<li>âœ… Type-safe</li>
<li>âœ… Field-level permissions</li>
<li>âœ… Environment-aware (time-based rules)</li>
<li>âœ… Clean architecture</li>
<li>âœ… Database-efficient</li>
</ul>
</div><div class="lesson-links"><a href="/fem-permission-systems-that-scale/lessons/abac/advanced-abac-features" class="prev">â† Previous</a><a href="/fem-permission-systems-that-scale/lessons/permission-libraries/why-use-a-library" class="next">Next â†’</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/DevSimplified"><svg fill="none" height="100%" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://github.com/WebDevSimplified"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul><div class="theme-icons"><button aria-label="Activate dark mode" title="Activate dark mode" class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="36px" height="100%" viewBox="0 -960 960 960" fill="var(--text-footer)" role="img"><title>Dark Mode Icon</title><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Z"></path></svg></button></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"title":"Clean Architecture: The Services Layer"},"html":"\u003cp\u003eOur ABAC system works, but authorization logic is scattered everywhere. Let\u0026#39;s fix that by introducing a \u003cstrong\u003eservices layer\u003c/strong\u003e that centralizes all permission checks.\u003c/p\u003e\n\u003ch2\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eCurrently, auth checks live in multiple places:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003eğŸ“ src/\nâ”œâ”€â”€ ğŸ“ actions/\nâ”‚   â”œâ”€â”€ documents.ts    â† Auth checks here\nâ”‚   â””â”€â”€ projects.ts     â† Auth checks here\nâ”œâ”€â”€ ğŸ“ dal/\nâ”‚   â””â”€â”€ documents.ts    â† And here\nâ””â”€â”€ ğŸ“ app/\n    â””â”€â”€ (pages)/\n        â”œâ”€â”€ documents/  â† And here too!\n        â””â”€â”€ projects/\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis creates problems:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eDuplication\u003c/strong\u003e - Same checks written multiple ways\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eInconsistency\u003c/strong\u003e - Easy to forget a check somewhere\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDifficult testing\u003c/strong\u003e - Auth logic tied to framework code\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePerformance\u003c/strong\u003e - Potentially extra database queries\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eThe Solution: Services Layer\u003c/h2\u003e\n\u003cp\u003eWe\u0026#39;ll create a dedicated layer for business logic which includes authorization checks:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003eğŸ“ src/\nâ”œâ”€â”€ ğŸ“ services/        â† NEW: All auth lives here\nâ”‚   â”œâ”€â”€ documents.ts\nâ”‚   â””â”€â”€ projects.ts\nâ”œâ”€â”€ ğŸ“ actions/         â† Just validates \u0026amp; calls services\nâ”œâ”€â”€ ğŸ“ dal/             â† Just database access\nâ””â”€â”€ ğŸ“ app/             â† Just UI concerns\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eA Basic Service\u003c/h2\u003e\n\u003cp\u003eThe key to our service layer is that each function in this layer should take into account all authorization checks and only return data the user has access to. This centralizes authorization logic and ensures consistency across the application.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreateDocumentService\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\n  \u003cspan class=\"hljs-attr\"\u003eprojectId\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003edata\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDocumentFormValues\u003c/span\u003e,\n\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment\"\u003e// Step 1: Authentication - who is making this request?\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetCurrentUser\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (user == \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Unauthenticated\u0026quot;\u003c/span\u003e)\n\n  \u003cspan class=\"hljs-comment\"\u003e// Step 2: Authorization - can they perform this action?\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e permissions = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetUserPermissions\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!permissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;create\u0026quot;\u003c/span\u003e)) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAuthorizationError\u003c/span\u003e()\n\n  \u003cspan class=\"hljs-comment\"\u003e// Step 3: Field filtering - only allow permitted fields\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e restrictedData = permissions.\u003cspan class=\"hljs-title function_\"\u003epickPermittedFields\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;create\u0026quot;\u003c/span\u003e,\n    data,\n  )\n\n  \u003cspan class=\"hljs-comment\"\u003e// Step 4: Validation - is the data valid?\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = documentSchema.\u003cspan class=\"hljs-title function_\"\u003esafeParse\u003c/span\u003e(restrictedData)\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!result.\u003cspan class=\"hljs-property\"\u003esuccess\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Invalid data\u0026quot;\u003c/span\u003e)\n\n  \u003cspan class=\"hljs-comment\"\u003e// Step 5: Execute - perform the actual operation\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreateDocument\u003c/span\u003e({\n    ...result.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ecreatorId\u003c/span\u003e: user.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003elastEditedById\u003c/span\u003e: user.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e,\n    projectId,\n  })\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIn the above example we are checking the user\u0026#39;s permission to create a document and ensuring only the fields they are allowed to modify are used for the creation. This centralizes authorization logic and prevents unauthorized field modifications.\u003c/p\u003e\n\u003cp\u003eOur action is now a simple wrapper that calls this service function and handles any errors or responses appropriately:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreateDocumentAction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\n  \u003cspan class=\"hljs-attr\"\u003eprojectId\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003edata\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDocumentFormValues\u003c/span\u003e,\n\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [error, \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e] = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003etryFn\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_\"\u003ecreateDocumentService\u003c/span\u003e(projectId, data),\n  )\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (error) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e error\n\n  \u003cspan class=\"hljs-title function_\"\u003eredirect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`/projects/\u003cspan class=\"hljs-subst\"\u003e${projectId}\u003c/span\u003e/documents/\u003cspan class=\"hljs-subst\"\u003e${\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.id}\u003c/span\u003e`\u003c/span\u003e)\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNotice what\u0026#39;s \u003cstrong\u003enot\u003c/strong\u003e in the action:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNo \u003ccode\u003eif (!canUpdate)\u003c/code\u003e checks\u003c/li\u003e\n\u003cli\u003eNo manual field filtering\u003c/li\u003e\n\u003cli\u003eNo permission imports\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAll that complexity lives in the service.\u003c/p\u003e\n\u003ch2\u003eRefactoring Page Components\u003c/h2\u003e\n\u003cp\u003ePages delegate to services and no longer include any direct permission checks:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eProjectDocumentsPage\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{\n  params,\n}: \u003cspan class=\"hljs-title class_\"\u003ePageProps\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-string\"\u003e\u0026quot;/projects/[projectId]\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { projectId } = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e params\n\n  \u003cspan class=\"hljs-comment\"\u003e// Returns null if not found or not authorized\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e project = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetProjectByIdService\u003c/span\u003e(projectId)\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (project == \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003enotFound\u003c/span\u003e()\n\n  \u003cspan class=\"hljs-comment\"\u003e// Only fetch documents the user is authorized to see\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e documents = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetProjectDocumentsService\u003c/span\u003e(projectId)\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"hljs-comment\"\u003e// UI\u003c/span\u003e\n  )\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eArchitecture Benefits\u003c/h2\u003e\n\u003ch3\u003e1. Single Responsibility\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eLayer\u003c/th\u003e\n\u003cth\u003eResponsibility\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003ePages\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003eRouting, layout, calling services\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eActions\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003eForm handling, validation, revalidation\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eServices\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003eBusiness logic, authorization\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eDAL\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003ePure database operations\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eThis is very important since now you can use the data access layer to get data without having to worry about authorization logic or user context since many times in your application you may want to get all records regardless of the current user\u0026#39;s permissions for specific business logic.\u003c/p\u003e\n\u003ch3\u003e2. Testability\u003c/h3\u003e\n\u003cp\u003eSince our data access layer, actions, and ui are no longer tied to the user or permissions we can easily test those layers in isolation. It is also easier to test our authorization logic since it all lives in one place.\u003c/p\u003e\n\u003ch3\u003e3. Security by Default\u003c/h3\u003e\n\u003cp\u003eAs long as all calls go through the service layer it is impossible to accidentally bypass authorization checks or incorrectly code an authorization check since it is all handled automatically by the services layer.\u003c/p\u003e\n\u003ch3\u003e4. Efficient Queries\u003c/h3\u003e\n\u003cp\u003eBy converting our auth permissions to a database query we are able to leverage the database\u0026#39;s query engine to efficiently filter results based on the user\u0026#39;s permissions, rather than fetching all data and filtering in application code.\u003c/p\u003e\n\u003ch2\u003eConverting Permissions to Database Queries\u003c/h2\u003e\n\u003cp\u003eThe key insight is that ABAC conditions can become \u003ccode\u003eWHERE\u003c/code\u003e clauses:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/fem-permission-systems-that-scale/images/04-abac/abac-to-sql.svg\" alt=\"ABAC to SQL\"\u003e\u003c/p\u003e\n\u003cp\u003eThis can get complicated when dealing with multiple conditions and various combinations of permissions, but once you get the base layer down adding new conditions is pretty simple.\u003c/p\u003e\n\u003cp\u003eThis is powerful because:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWe only fetch data the user can see\u003c/li\u003e\n\u003cli\u003eThe database does the filtering (efficient!)\u003c/li\u003e\n\u003cli\u003eNo chance of data leaks from forgetting a filter\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eLive Coding Exercise\u003c/h2\u003e\n\u003cp\u003eWe\u0026#39;ll refactor the codebase to:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCreate \u003ccode\u003esrc/services/documents.ts\u003c/code\u003e and \u003ccode\u003esrc/services/projects.ts\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eImplement \u003ccode\u003etoDrizzleWhere()\u003c/code\u003e for automatic query generation\u003c/li\u003e\n\u003cli\u003eRefactor actions to use services\u003c/li\u003e\n\u003cli\u003eUpdate page components to use services\u003c/li\u003e\n\u003cli\u003eRemove auth code from actions and DAL\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eBranch Checkpoint\u003c/h2\u003e\n\u003cp\u003eAfter completing this lesson, your code should match:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003egit checkout 6-abac-advanced\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eSummary\u003c/h2\u003e\n\u003cp\u003eThe services layer pattern:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCentralizes\u003c/strong\u003e all authorization in one place\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eConverts\u003c/strong\u003e ABAC conditions to database queries\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSimplifies\u003c/strong\u003e actions and components\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eEnables\u003c/strong\u003e easy testing of permissions\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePrevents\u003c/strong\u003e data leaks by filtering at the query level\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOur ABAC implementation is now:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eâœ… Type-safe\u003c/li\u003e\n\u003cli\u003eâœ… Field-level permissions\u003c/li\u003e\n\u003cli\u003eâœ… Environment-aware (time-based rules)\u003c/li\u003e\n\u003cli\u003eâœ… Clean architecture\u003c/li\u003e\n\u003cli\u003eâœ… Database-efficient\u003c/li\u003e\n\u003c/ul\u003e\n","markdown":"\nOur ABAC system works, but authorization logic is scattered everywhere. Let's fix that by introducing a **services layer** that centralizes all permission checks.\n\n## The Problem\n\nCurrently, auth checks live in multiple places:\n\n```text\nğŸ“ src/\nâ”œâ”€â”€ ğŸ“ actions/\nâ”‚   â”œâ”€â”€ documents.ts    â† Auth checks here\nâ”‚   â””â”€â”€ projects.ts     â† Auth checks here\nâ”œâ”€â”€ ğŸ“ dal/\nâ”‚   â””â”€â”€ documents.ts    â† And here\nâ””â”€â”€ ğŸ“ app/\n    â””â”€â”€ (pages)/\n        â”œâ”€â”€ documents/  â† And here too!\n        â””â”€â”€ projects/\n```\n\nThis creates problems:\n\n1. **Duplication** - Same checks written multiple ways\n2. **Inconsistency** - Easy to forget a check somewhere\n3. **Difficult testing** - Auth logic tied to framework code\n4. **Performance** - Potentially extra database queries\n\n## The Solution: Services Layer\n\nWe'll create a dedicated layer for business logic which includes authorization checks:\n\n```text\nğŸ“ src/\nâ”œâ”€â”€ ğŸ“ services/        â† NEW: All auth lives here\nâ”‚   â”œâ”€â”€ documents.ts\nâ”‚   â””â”€â”€ projects.ts\nâ”œâ”€â”€ ğŸ“ actions/         â† Just validates \u0026 calls services\nâ”œâ”€â”€ ğŸ“ dal/             â† Just database access\nâ””â”€â”€ ğŸ“ app/             â† Just UI concerns\n```\n\n## A Basic Service\n\nThe key to our service layer is that each function in this layer should take into account all authorization checks and only return data the user has access to. This centralizes authorization logic and ensures consistency across the application.\n\n```typescript\nexport async function createDocumentService(\n  projectId: string,\n  data: DocumentFormValues,\n) {\n  // Step 1: Authentication - who is making this request?\n  const user = await getCurrentUser()\n  if (user == null) throw new Error(\"Unauthenticated\")\n\n  // Step 2: Authorization - can they perform this action?\n  const permissions = await getUserPermissions()\n  if (!permissions.can(\"document\", \"create\")) throw new AuthorizationError()\n\n  // Step 3: Field filtering - only allow permitted fields\n  const restrictedData = permissions.pickPermittedFields(\n    \"document\",\n    \"create\",\n    data,\n  )\n\n  // Step 4: Validation - is the data valid?\n  const result = documentSchema.safeParse(restrictedData)\n  if (!result.success) throw new Error(\"Invalid data\")\n\n  // Step 5: Execute - perform the actual operation\n  return await createDocument({\n    ...result.data,\n    creatorId: user.id,\n    lastEditedById: user.id,\n    projectId,\n  })\n}\n```\n\nIn the above example we are checking the user's permission to create a document and ensuring only the fields they are allowed to modify are used for the creation. This centralizes authorization logic and prevents unauthorized field modifications.\n\nOur action is now a simple wrapper that calls this service function and handles any errors or responses appropriately:\n\n```typescript\nexport async function createDocumentAction(\n  projectId: string,\n  data: DocumentFormValues,\n) {\n  const [error, document] = await tryFn(() =\u003e\n    createDocumentService(projectId, data),\n  )\n\n  if (error) return error\n\n  redirect(`/projects/${projectId}/documents/${document.id}`)\n}\n```\n\nNotice what's **not** in the action:\n\n- No `if (!canUpdate)` checks\n- No manual field filtering\n- No permission imports\n\nAll that complexity lives in the service.\n\n## Refactoring Page Components\n\nPages delegate to services and no longer include any direct permission checks:\n\n```typescript\nexport default async function ProjectDocumentsPage({\n  params,\n}: PageProps\u003c\"/projects/[projectId]\"\u003e) {\n  const { projectId } = await params\n\n  // Returns null if not found or not authorized\n  const project = await getProjectByIdService(projectId)\n  if (project == null) return notFound()\n\n  // Only fetch documents the user is authorized to see\n  const documents = await getProjectDocumentsService(projectId)\n\n  return (\n    // UI\n  )\n}\n```\n\n## Architecture Benefits\n\n### 1. Single Responsibility\n\n| Layer        | Responsibility                          |\n| ------------ | --------------------------------------- |\n| **Pages**    | Routing, layout, calling services       |\n| **Actions**  | Form handling, validation, revalidation |\n| **Services** | Business logic, authorization           |\n| **DAL**      | Pure database operations                |\n\nThis is very important since now you can use the data access layer to get data without having to worry about authorization logic or user context since many times in your application you may want to get all records regardless of the current user's permissions for specific business logic.\n\n### 2. Testability\n\nSince our data access layer, actions, and ui are no longer tied to the user or permissions we can easily test those layers in isolation. It is also easier to test our authorization logic since it all lives in one place.\n\n### 3. Security by Default\n\nAs long as all calls go through the service layer it is impossible to accidentally bypass authorization checks or incorrectly code an authorization check since it is all handled automatically by the services layer.\n\n### 4. Efficient Queries\n\nBy converting our auth permissions to a database query we are able to leverage the database's query engine to efficiently filter results based on the user's permissions, rather than fetching all data and filtering in application code.\n\n## Converting Permissions to Database Queries\n\nThe key insight is that ABAC conditions can become `WHERE` clauses:\n\n![ABAC to SQL](/fem-permission-systems-that-scale/images/04-abac/abac-to-sql.svg)\n\nThis can get complicated when dealing with multiple conditions and various combinations of permissions, but once you get the base layer down adding new conditions is pretty simple.\n\nThis is powerful because:\n\n- We only fetch data the user can see\n- The database does the filtering (efficient!)\n- No chance of data leaks from forgetting a filter\n\n## Live Coding Exercise\n\nWe'll refactor the codebase to:\n\n1. Create `src/services/documents.ts` and `src/services/projects.ts`\n2. Implement `toDrizzleWhere()` for automatic query generation\n3. Refactor actions to use services\n4. Update page components to use services\n5. Remove auth code from actions and DAL\n\n## Branch Checkpoint\n\nAfter completing this lesson, your code should match:\n\n```bash\ngit checkout 6-abac-advanced\n```\n\n## Summary\n\nThe services layer pattern:\n\n- **Centralizes** all authorization in one place\n- **Converts** ABAC conditions to database queries\n- **Simplifies** actions and components\n- **Enables** easy testing of permissions\n- **Prevents** data leaks by filtering at the query level\n\nOur ABAC implementation is now:\n\n- âœ… Type-safe\n- âœ… Field-level permissions\n- âœ… Environment-aware (time-based rules)\n- âœ… Clean architecture\n- âœ… Database-efficient\n","slug":"clean-architecture-services","title":"Clean Architecture: The Services Layer","section":"Attribute-Based Access Control (ABAC)","icon":"cog","filePath":"/home/runner/work/fem-permission-systems-that-scale/fem-permission-systems-that-scale/lessons/04-abac/D-clean-architecture-services.md","nextSlug":"/fem-permission-systems-that-scale/lessons/permission-libraries/why-use-a-library","prevSlug":"/fem-permission-systems-that-scale/lessons/abac/advanced-abac-features"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"abac","slug":"clean-architecture-services"},"buildId":"Z1s-VsOExbnNujkBZEKnx","assetPrefix":"/fem-permission-systems-that-scale","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>