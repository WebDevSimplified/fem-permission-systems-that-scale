<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/fem-permission-systems-that-scale/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/fem-permission-systems-that-scale/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/fem-permission-systems-that-scale/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/fem-permission-systems-that-scale/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/fem-permission-systems-that-scale/images/favicon.ico" data-next-head=""/><title data-next-head="">Advanced ABAC Features – Permission Systems that Scale</title><meta name="description" content="Learn how to implement robust permission systems in your web applications. Master RBAC, ABAC, field-level permissions, and build your own authorization engine from scratch using TypeScript." data-next-head=""/><meta name="keywords" content="Permissions,Authorization,RBAC,ABAC,Access Control,TypeScript,Security,CASL,Web Dev Simplified,Frontend Masters" data-next-head=""/><meta name="og:description" content="Learn how to implement robust permission systems in your web applications. Master RBAC, ABAC, field-level permissions, and build your own authorization engine from scratch using TypeScript." data-next-head=""/><meta name="og:title" content="Advanced ABAC Features – Permission Systems that Scale" data-next-head=""/><meta name="og:image" content="/fem-permission-systems-that-scale/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/fem-permission-systems-that-scale/_next/static/css/3e2d260a483e4ce6.css" as="style"/><link rel="stylesheet" href="/fem-permission-systems-that-scale/_next/static/css/3e2d260a483e4ce6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/fem-permission-systems-that-scale/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/webpack-561d6b920ac5fc2e.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/main-8377b0572add80b6.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/pages/_app-ab9f88be91011ccd.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-c23b0a3ff434a742.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/Z1s-VsOExbnNujkBZEKnx/_buildManifest.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/Z1s-VsOExbnNujkBZEKnx/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/fem-permission-systems-that-scale">Permission Systems that Scale</a></h1><div class="navbar-info"></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>Our basic ABAC system works, but real applications need more sophisticated features. Let&#39;s add <strong>field-level permissions</strong> and explore how ABAC can express complex policies.</p>
<h2>New Requirements</h2>
<p>In many applications certain users are restricted on which fields they can read or modify. This is something that is impossible to do in RBAC, but ABAC makes these policies straightforward to express using field-level permissions.</p>
<h3>1. Field-Level Read Permissions</h3>
<p>Different roles should see different fields on documents:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Admin</th>
<th>Editor</th>
<th>Author</th>
<th>Viewer</th>
</tr>
</thead>
<tbody><tr>
<td><code>title</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><code>content</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><code>status</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><code>isLocked</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><code>creatorId</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><code>lastEditedById</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><code>createdAt</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><code>updatedAt</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
</tbody></table>
<h3>2. Field-Level Write Permissions</h3>
<p>When creating or editing documents, only certain fields should be writable:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Admin</th>
<th>Editor</th>
<th>Author</th>
</tr>
</thead>
<tbody><tr>
<td><code>title</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><code>content</code></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><code>status</code></td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><code>isLocked</code></td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
</tbody></table>
<p>Authors can write content but can&#39;t change document status or lock documents.</p>
<h3>3. 3. Environment-Based Rules</h3>
<p>Since this company values work-life balance, editors and authors are not allowed to make changes on weekends which is an example of an <strong>environment-based</strong> rule that uses attributes from neither the user nor the resource.</p>
<h2>Extending the Permission API</h2>
<p>We need to enhance our <code>can()</code> function to support field checks:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-comment">// Check if user can read a specific field</span>
permissions.<span class="hljs-title function_">can</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>, <span class="hljs-variable language_">document</span>, <span class="hljs-string">&quot;isLocked&quot;</span>)

<span class="hljs-comment">// Check if user can update a specific field</span>
permissions.<span class="hljs-title function_">can</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-variable language_">document</span>, <span class="hljs-string">&quot;status&quot;</span>)
</code></pre><h2>Enhanced Policy Definitions</h2>
<p>The <code>allow</code> function now accepts an optional fields array as a fourth parameter:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">function</span> <span class="hljs-title function_">addEditorPermissions</span>(<span class="hljs-params">
  <span class="hljs-attr">builder</span>: <span class="hljs-title class_">PermissionBuilder</span>,
  <span class="hljs-attr">user</span>: <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">&quot;department&quot;</span>&gt;,
</span>) {
  builder.<span class="hljs-title function_">allow</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>) <span class="hljs-comment">// All fields by default</span>

  builder.<span class="hljs-title function_">allow</span>(
    <span class="hljs-string">&quot;document&quot;</span>,
    <span class="hljs-string">&quot;update&quot;</span>,
    { <span class="hljs-attr">isLocked</span>: <span class="hljs-literal">false</span> }, <span class="hljs-comment">// Condition: only unlocked docs</span>
    [<span class="hljs-string">&quot;content&quot;</span>, <span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;status&quot;</span>], <span class="hljs-comment">// Restricted to these fields</span>
  )
}
</code></pre><h2>Updating the Permission Builder</h2>
<p>We only need to change two things in our existing builder:</p>
<h3>1. Add <code>fields</code> to the <code>allow()</code> method</h3>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button>allow&lt;<span class="hljs-title class_">Res</span> <span class="hljs-keyword">extends</span> keyof <span class="hljs-title class_">Resources</span>&gt;(
  <span class="hljs-attr">resource</span>: <span class="hljs-title class_">Res</span>,
  <span class="hljs-attr">action</span>: <span class="hljs-title class_">Resources</span>[<span class="hljs-title class_">Res</span>][<span class="hljs-string">&quot;action&quot;</span>],
  <span class="hljs-attr">condition</span>?: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Resources</span>[<span class="hljs-title class_">Res</span>][<span class="hljs-string">&quot;condition&quot;</span>]&gt;,
  <span class="hljs-attr">fields</span>?: <span class="hljs-built_in">string</span>[], <span class="hljs-comment">// NEW: optional field restriction</span>
) {
  <span class="hljs-variable language_">this</span>.#permissions[resource].<span class="hljs-title function_">push</span>({ action, condition, fields })
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>
}
</code></pre><h3>2. Check fields in <code>can()</code></h3>
<p>Add this after the condition check passes:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-comment">// Check field permission (new logic)</span>
<span class="hljs-keyword">if</span> (field != <span class="hljs-literal">null</span> &amp;&amp; perm.<span class="hljs-property">fields</span> != <span class="hljs-literal">null</span>) {
  <span class="hljs-keyword">return</span> perm.<span class="hljs-property">fields</span>.<span class="hljs-title function_">includes</span>(field)
}
</code></pre><p>The full logic: if a field is requested AND this permission specifies allowed fields, check if the field is in the list. If <code>perm.fields</code> is <code>null</code>, all fields are allowed.</p>
<h2>Using Field Permissions</h2>
<p>Adding support for field permissions takes a little bit of TypeScript wizardry and extra work, but for the most part isn&#39;t too bad. Where field permissions become difficult to work with is when consuming which fields a user has access to and ensuring your UI works for all possible permutations.</p>
<h3>In Forms</h3>
<p>We compute which fields the user can modify, then pass that info to the form component:</p>
<pre><code class="hljs language-tsx"><button class="copy-btn">Copy</button><span class="hljs-comment">// Edit document page</span>
<span class="hljs-keyword">const</span> permissions = <span class="hljs-title function_">getUserPermissions</span>(user)

&lt;<span class="hljs-title class_">DocumentForm</span>
  <span class="hljs-variable language_">document</span>={<span class="hljs-variable language_">document</span>}
  projectId={projectId}
  canModify={{
    <span class="hljs-attr">status</span>: permissions.<span class="hljs-title function_">can</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-variable language_">document</span>, <span class="hljs-string">&quot;status&quot;</span>),
    <span class="hljs-attr">isLocked</span>: permissions.<span class="hljs-title function_">can</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-variable language_">document</span>, <span class="hljs-string">&quot;isLocked&quot;</span>),
  }}
/&gt;
</code></pre><p>Why pass <code>canModify</code> as a prop instead of checking permissions inside the form? This keeps the form component <strong>pure</strong> since it just renders based on props, making it easier to test and reuse. It also ensures these components are easier to test and reuse.</p>
<h3>In the Form Component</h3>
<p>The form conditionally renders fields based on permissions:</p>
<pre><code class="hljs language-tsx"><button class="copy-btn">Copy</button><span class="hljs-keyword">function</span> <span class="hljs-title function_">DocumentForm</span>(<span class="hljs-params">{ <span class="hljs-variable language_">document</span>, projectId, canModify }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Form</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;title&quot;</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;content&quot;</span> /&gt;</span>

      {canModify.status &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">Select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;status&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;draft&quot;</span>&gt;</span>Draft<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;published&quot;</span>&gt;</span>Published<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;archived&quot;</span>&gt;</span>Archived<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Select</span>&gt;</span>
      )}

      {canModify.isLocked &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Checkbox</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;isLocked&quot;</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;Lock document&quot;</span> /&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Form</span>&gt;</span></span>
  )
}
</code></pre><h3>In Display Components</h3>
<p>For read permissions, we hide fields the user can&#39;t see:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-comment">// Document detail page</span>
<span class="hljs-keyword">const</span> permissions = <span class="hljs-title function_">getUserPermissions</span>(user)

<span class="hljs-keyword">const</span> canReadField = {
  <span class="hljs-attr">isLocked</span>: permissions.<span class="hljs-title function_">can</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>, <span class="hljs-variable language_">document</span>, <span class="hljs-string">&quot;isLocked&quot;</span>),
  <span class="hljs-attr">creator</span>: permissions.<span class="hljs-title function_">can</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>, <span class="hljs-variable language_">document</span>, <span class="hljs-string">&quot;creatorId&quot;</span>),
}

<span class="hljs-comment">// In JSX</span>
{canReadField.<span class="hljs-property">isLocked</span> &amp;&amp; <span class="hljs-variable language_">document</span>.<span class="hljs-property">isLocked</span> &amp;&amp; (
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Badge</span>&gt;</span>Locked<span class="hljs-tag">&lt;/<span class="hljs-name">Badge</span>&gt;</span></span>
)}

{canReadField.<span class="hljs-property">creator</span> &amp;&amp; (
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Created by: {document.creator.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
)}
</code></pre><h2>Filtering Permitted Fields</h2>
<p>When handling form submissions, we need to filter out fields the user isn&#39;t allowed to modify, even if they try to send them from the client:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">function</span> pickPermittedFields&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(
  <span class="hljs-attr">permissions</span>: <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> getUserPermissions&gt;,
  <span class="hljs-attr">resource</span>: keyof <span class="hljs-title class_">Resources</span>,
  <span class="hljs-attr">action</span>: <span class="hljs-built_in">string</span>,
  <span class="hljs-attr">data</span>: T,
  <span class="hljs-attr">resourceData</span>?: <span class="hljs-title class_">Resources</span>[keyof <span class="hljs-title class_">Resources</span>][<span class="hljs-string">&quot;condition&quot;</span>],
): <span class="hljs-title class_">Partial</span>&lt;T&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt; = {}

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(data)) {
    <span class="hljs-keyword">if</span> (permissions.<span class="hljs-title function_">can</span>(resource, action, resourceData, key)) {
      result[key] = value
    }
  }

  <span class="hljs-keyword">return</span> result <span class="hljs-keyword">as</span> <span class="hljs-title class_">Partial</span>&lt;T&gt;
}
</code></pre><p>This is useful during mutations since it ensures security even if someone bypasses the UI:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">const</span> restrictedData = <span class="hljs-title function_">pickPermittedFields</span>(
  permissions,
  <span class="hljs-string">&quot;document&quot;</span>,
  <span class="hljs-string">&quot;update&quot;</span>,
  formData,
  existingDocument,
)
<span class="hljs-comment">// restrictedData only contains fields the user can actually modify</span>
</code></pre><h2>Implementing Environment Rules</h2>
<p>For weekend restrictions, we check the current day when building permissions:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">function</span> <span class="hljs-title function_">addEditorPermissions</span>(<span class="hljs-params">
  <span class="hljs-attr">builder</span>: <span class="hljs-title class_">PermissionBuilder</span>,
  <span class="hljs-attr">user</span>: <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">&quot;department&quot;</span>&gt;,
</span>) {
  <span class="hljs-keyword">const</span> dayOfWeek = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getDay</span>()
  <span class="hljs-keyword">const</span> isWeekend = dayOfWeek === <span class="hljs-number">0</span> || dayOfWeek === <span class="hljs-number">6</span>

  builder
    .<span class="hljs-title function_">allow</span>(<span class="hljs-string">&quot;project&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>, { <span class="hljs-attr">department</span>: user.<span class="hljs-property">department</span> })
    .<span class="hljs-title function_">allow</span>(<span class="hljs-string">&quot;project&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>, { <span class="hljs-attr">department</span>: <span class="hljs-literal">null</span> })
    .<span class="hljs-title function_">allow</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>)

  <span class="hljs-comment">// Only allow updates on weekdays</span>
  <span class="hljs-keyword">if</span> (!isWeekend) {
    builder.<span class="hljs-title function_">allow</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, { <span class="hljs-attr">isLocked</span>: <span class="hljs-literal">false</span> })
  }
}
</code></pre><p>The permission decision can incorporate <strong>any</strong> attribute: user, resource, or environment.</p>
<h2>The Power of ABAC</h2>
<p>Notice what we can now express:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-comment">// &quot;Authors can read the createdAt field only on documents they created&quot;</span>
permissions.<span class="hljs-title function_">can</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>, { <span class="hljs-attr">creatorId</span>: user.<span class="hljs-property">id</span> }, <span class="hljs-string">&quot;createdAt&quot;</span>)

<span class="hljs-comment">// &quot;Editors can update status on unlocked documents&quot;</span>
permissions.<span class="hljs-title function_">can</span>(<span class="hljs-string">&quot;document&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, { <span class="hljs-attr">isLocked</span>: <span class="hljs-literal">false</span> }, <span class="hljs-string">&quot;status&quot;</span>)
</code></pre><p>These complex, conditional, field-level permissions are natural in ABAC but would require an explosion of permission strings in RBAC.</p>
<h2>What&#39;s Next</h2>
<p>Our ABAC system is powerful, but we still have permission checks scattered throughout:</p>
<ul>
<li>Page components</li>
<li>Server actions</li>
<li>Mutations</li>
<li>Query functions</li>
</ul>
<p>In the next lesson, we&#39;ll create a <strong>services layer</strong> that centralizes all authorization logic and even converts permissions to database queries automatically.</p>
</div><div class="lesson-links"><a href="/fem-permission-systems-that-scale/lessons/abac/converting-to-abac" class="prev">← Previous</a><a href="/fem-permission-systems-that-scale/lessons/abac/clean-architecture-services" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/DevSimplified"><svg fill="none" height="100%" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://github.com/WebDevSimplified"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul><div class="theme-icons"><button aria-label="Activate dark mode" title="Activate dark mode" class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="36px" height="100%" viewBox="0 -960 960 960" fill="var(--text-footer)" role="img"><title>Dark Mode Icon</title><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Z"></path></svg></button></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"title":"Advanced ABAC Features"},"html":"\u003cp\u003eOur basic ABAC system works, but real applications need more sophisticated features. Let\u0026#39;s add \u003cstrong\u003efield-level permissions\u003c/strong\u003e and explore how ABAC can express complex policies.\u003c/p\u003e\n\u003ch2\u003eNew Requirements\u003c/h2\u003e\n\u003cp\u003eIn many applications certain users are restricted on which fields they can read or modify. This is something that is impossible to do in RBAC, but ABAC makes these policies straightforward to express using field-level permissions.\u003c/p\u003e\n\u003ch3\u003e1. Field-Level Read Permissions\u003c/h3\u003e\n\u003cp\u003eDifferent roles should see different fields on documents:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eField\u003c/th\u003e\n\u003cth\u003eAdmin\u003c/th\u003e\n\u003cth\u003eEditor\u003c/th\u003e\n\u003cth\u003eAuthor\u003c/th\u003e\n\u003cth\u003eViewer\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003etitle\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003econtent\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003estatus\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eisLocked\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003ecreatorId\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elastEditedById\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003ecreatedAt\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eupdatedAt\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch3\u003e2. Field-Level Write Permissions\u003c/h3\u003e\n\u003cp\u003eWhen creating or editing documents, only certain fields should be writable:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eField\u003c/th\u003e\n\u003cth\u003eAdmin\u003c/th\u003e\n\u003cth\u003eEditor\u003c/th\u003e\n\u003cth\u003eAuthor\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003etitle\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003econtent\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003estatus\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eisLocked\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eAuthors can write content but can\u0026#39;t change document status or lock documents.\u003c/p\u003e\n\u003ch3\u003e3. 3. Environment-Based Rules\u003c/h3\u003e\n\u003cp\u003eSince this company values work-life balance, editors and authors are not allowed to make changes on weekends which is an example of an \u003cstrong\u003eenvironment-based\u003c/strong\u003e rule that uses attributes from neither the user nor the resource.\u003c/p\u003e\n\u003ch2\u003eExtending the Permission API\u003c/h2\u003e\n\u003cp\u003eWe need to enhance our \u003ccode\u003ecan()\u003c/code\u003e function to support field checks:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-comment\"\u003e// Check if user can read a specific field\u003c/span\u003e\npermissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;read\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;isLocked\u0026quot;\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e// Check if user can update a specific field\u003c/span\u003e\npermissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;update\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;status\u0026quot;\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eEnhanced Policy Definitions\u003c/h2\u003e\n\u003cp\u003eThe \u003ccode\u003eallow\u003c/code\u003e function now accepts an optional fields array as a fourth parameter:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eaddEditorPermissions\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebuilder\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePermissionBuilder\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePick\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;department\u0026quot;\u003c/span\u003e\u0026gt;,\n\u003c/span\u003e) {\n  builder.\u003cspan class=\"hljs-title function_\"\u003eallow\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;read\u0026quot;\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// All fields by default\u003c/span\u003e\n\n  builder.\u003cspan class=\"hljs-title function_\"\u003eallow\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;update\u0026quot;\u003c/span\u003e,\n    { \u003cspan class=\"hljs-attr\"\u003eisLocked\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e }, \u003cspan class=\"hljs-comment\"\u003e// Condition: only unlocked docs\u003c/span\u003e\n    [\u003cspan class=\"hljs-string\"\u003e\u0026quot;content\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;title\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;status\u0026quot;\u003c/span\u003e], \u003cspan class=\"hljs-comment\"\u003e// Restricted to these fields\u003c/span\u003e\n  )\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eUpdating the Permission Builder\u003c/h2\u003e\n\u003cp\u003eWe only need to change two things in our existing builder:\u003c/p\u003e\n\u003ch3\u003e1. Add \u003ccode\u003efields\u003c/code\u003e to the \u003ccode\u003eallow()\u003c/code\u003e method\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003eallow\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eRes\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e keyof \u003cspan class=\"hljs-title class_\"\u003eResources\u003c/span\u003e\u0026gt;(\n  \u003cspan class=\"hljs-attr\"\u003eresource\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eRes\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eaction\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eResources\u003c/span\u003e[\u003cspan class=\"hljs-title class_\"\u003eRes\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\u0026quot;action\u0026quot;\u003c/span\u003e],\n  \u003cspan class=\"hljs-attr\"\u003econdition\u003c/span\u003e?: \u003cspan class=\"hljs-title class_\"\u003ePartial\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eResources\u003c/span\u003e[\u003cspan class=\"hljs-title class_\"\u003eRes\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\u0026quot;condition\u0026quot;\u003c/span\u003e]\u0026gt;,\n  \u003cspan class=\"hljs-attr\"\u003efields\u003c/span\u003e?: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e[], \u003cspan class=\"hljs-comment\"\u003e// NEW: optional field restriction\u003c/span\u003e\n) {\n  \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.#permissions[resource].\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e({ action, condition, fields })\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003e2. Check fields in \u003ccode\u003ecan()\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003eAdd this after the condition check passes:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-comment\"\u003e// Check field permission (new logic)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (field != \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e \u0026amp;\u0026amp; perm.\u003cspan class=\"hljs-property\"\u003efields\u003c/span\u003e != \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e perm.\u003cspan class=\"hljs-property\"\u003efields\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eincludes\u003c/span\u003e(field)\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe full logic: if a field is requested AND this permission specifies allowed fields, check if the field is in the list. If \u003ccode\u003eperm.fields\u003c/code\u003e is \u003ccode\u003enull\u003c/code\u003e, all fields are allowed.\u003c/p\u003e\n\u003ch2\u003eUsing Field Permissions\u003c/h2\u003e\n\u003cp\u003eAdding support for field permissions takes a little bit of TypeScript wizardry and extra work, but for the most part isn\u0026#39;t too bad. Where field permissions become difficult to work with is when consuming which fields a user has access to and ensuring your UI works for all possible permutations.\u003c/p\u003e\n\u003ch3\u003eIn Forms\u003c/h3\u003e\n\u003cp\u003eWe compute which fields the user can modify, then pass that info to the form component:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-comment\"\u003e// Edit document page\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e permissions = \u003cspan class=\"hljs-title function_\"\u003egetUserPermissions\u003c/span\u003e(user)\n\n\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eDocumentForm\u003c/span\u003e\n  \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e={\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e}\n  projectId={projectId}\n  canModify={{\n    \u003cspan class=\"hljs-attr\"\u003estatus\u003c/span\u003e: permissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;update\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;status\u0026quot;\u003c/span\u003e),\n    \u003cspan class=\"hljs-attr\"\u003eisLocked\u003c/span\u003e: permissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;update\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;isLocked\u0026quot;\u003c/span\u003e),\n  }}\n/\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eWhy pass \u003ccode\u003ecanModify\u003c/code\u003e as a prop instead of checking permissions inside the form? This keeps the form component \u003cstrong\u003epure\u003c/strong\u003e since it just renders based on props, making it easier to test and reuse. It also ensures these components are easier to test and reuse.\u003c/p\u003e\n\u003ch3\u003eIn the Form Component\u003c/h3\u003e\n\u003cp\u003eThe form conditionally renders fields based on permissions:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eDocumentForm\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e, projectId, canModify }\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eForm\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eInput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;title\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eTextarea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;content\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n\n      {canModify.status \u0026amp;\u0026amp; (\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eSelect\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;status\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;draft\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003eDraft\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;published\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003ePublished\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;archived\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003eArchived\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eSelect\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      )}\n\n      {canModify.isLocked \u0026amp;\u0026amp; \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eCheckbox\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;isLocked\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elabel\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;Lock document\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e}\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eForm\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  )\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch3\u003eIn Display Components\u003c/h3\u003e\n\u003cp\u003eFor read permissions, we hide fields the user can\u0026#39;t see:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-comment\"\u003e// Document detail page\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e permissions = \u003cspan class=\"hljs-title function_\"\u003egetUserPermissions\u003c/span\u003e(user)\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e canReadField = {\n  \u003cspan class=\"hljs-attr\"\u003eisLocked\u003c/span\u003e: permissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;read\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;isLocked\u0026quot;\u003c/span\u003e),\n  \u003cspan class=\"hljs-attr\"\u003ecreator\u003c/span\u003e: permissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;read\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;creatorId\u0026quot;\u003c/span\u003e),\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// In JSX\u003c/span\u003e\n{canReadField.\u003cspan class=\"hljs-property\"\u003eisLocked\u003c/span\u003e \u0026amp;\u0026amp; \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eisLocked\u003c/span\u003e \u0026amp;\u0026amp; (\n  \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eBadge\u003c/span\u003e\u0026gt;\u003c/span\u003eLocked\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eBadge\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n)}\n\n{canReadField.\u003cspan class=\"hljs-property\"\u003ecreator\u003c/span\u003e \u0026amp;\u0026amp; (\n  \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003eCreated by: {document.creator.name}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n)}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eFiltering Permitted Fields\u003c/h2\u003e\n\u003cp\u003eWhen handling form submissions, we need to filter out fields the user isn\u0026#39;t allowed to modify, even if they try to send them from the client:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e pickPermittedFields\u0026lt;T \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eRecord\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eunknown\u003c/span\u003e\u0026gt;\u0026gt;(\n  \u003cspan class=\"hljs-attr\"\u003epermissions\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eReturnType\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e getUserPermissions\u0026gt;,\n  \u003cspan class=\"hljs-attr\"\u003eresource\u003c/span\u003e: keyof \u003cspan class=\"hljs-title class_\"\u003eResources\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eaction\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003edata\u003c/span\u003e: T,\n  \u003cspan class=\"hljs-attr\"\u003eresourceData\u003c/span\u003e?: \u003cspan class=\"hljs-title class_\"\u003eResources\u003c/span\u003e[keyof \u003cspan class=\"hljs-title class_\"\u003eResources\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\u0026quot;condition\u0026quot;\u003c/span\u003e],\n): \u003cspan class=\"hljs-title class_\"\u003ePartial\u003c/span\u003e\u0026lt;T\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eresult\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eRecord\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eunknown\u003c/span\u003e\u0026gt; = {}\n\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [key, value] \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eentries\u003c/span\u003e(data)) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (permissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(resource, action, resourceData, key)) {\n      result[key] = value\n    }\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePartial\u003c/span\u003e\u0026lt;T\u0026gt;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis is useful during mutations since it ensures security even if someone bypasses the UI:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e restrictedData = \u003cspan class=\"hljs-title function_\"\u003epickPermittedFields\u003c/span\u003e(\n  permissions,\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;update\u0026quot;\u003c/span\u003e,\n  formData,\n  existingDocument,\n)\n\u003cspan class=\"hljs-comment\"\u003e// restrictedData only contains fields the user can actually modify\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eImplementing Environment Rules\u003c/h2\u003e\n\u003cp\u003eFor weekend restrictions, we check the current day when building permissions:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eaddEditorPermissions\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebuilder\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePermissionBuilder\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePick\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;department\u0026quot;\u003c/span\u003e\u0026gt;,\n\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dayOfWeek = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003egetDay\u003c/span\u003e()\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isWeekend = dayOfWeek === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e || dayOfWeek === \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e\n\n  builder\n    .\u003cspan class=\"hljs-title function_\"\u003eallow\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;project\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;read\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003edepartment\u003c/span\u003e: user.\u003cspan class=\"hljs-property\"\u003edepartment\u003c/span\u003e })\n    .\u003cspan class=\"hljs-title function_\"\u003eallow\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;project\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;read\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003edepartment\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e })\n    .\u003cspan class=\"hljs-title function_\"\u003eallow\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;read\u0026quot;\u003c/span\u003e)\n\n  \u003cspan class=\"hljs-comment\"\u003e// Only allow updates on weekdays\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!isWeekend) {\n    builder.\u003cspan class=\"hljs-title function_\"\u003eallow\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;update\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eisLocked\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e })\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe permission decision can incorporate \u003cstrong\u003eany\u003c/strong\u003e attribute: user, resource, or environment.\u003c/p\u003e\n\u003ch2\u003eThe Power of ABAC\u003c/h2\u003e\n\u003cp\u003eNotice what we can now express:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-comment\"\u003e// \u0026quot;Authors can read the createdAt field only on documents they created\u0026quot;\u003c/span\u003e\npermissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;read\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003ecreatorId\u003c/span\u003e: user.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e }, \u003cspan class=\"hljs-string\"\u003e\u0026quot;createdAt\u0026quot;\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e// \u0026quot;Editors can update status on unlocked documents\u0026quot;\u003c/span\u003e\npermissions.\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;document\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;update\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eisLocked\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e }, \u003cspan class=\"hljs-string\"\u003e\u0026quot;status\u0026quot;\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThese complex, conditional, field-level permissions are natural in ABAC but would require an explosion of permission strings in RBAC.\u003c/p\u003e\n\u003ch2\u003eWhat\u0026#39;s Next\u003c/h2\u003e\n\u003cp\u003eOur ABAC system is powerful, but we still have permission checks scattered throughout:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePage components\u003c/li\u003e\n\u003cli\u003eServer actions\u003c/li\u003e\n\u003cli\u003eMutations\u003c/li\u003e\n\u003cli\u003eQuery functions\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn the next lesson, we\u0026#39;ll create a \u003cstrong\u003eservices layer\u003c/strong\u003e that centralizes all authorization logic and even converts permissions to database queries automatically.\u003c/p\u003e\n","markdown":"\nOur basic ABAC system works, but real applications need more sophisticated features. Let's add **field-level permissions** and explore how ABAC can express complex policies.\n\n## New Requirements\n\nIn many applications certain users are restricted on which fields they can read or modify. This is something that is impossible to do in RBAC, but ABAC makes these policies straightforward to express using field-level permissions.\n\n### 1. Field-Level Read Permissions\n\nDifferent roles should see different fields on documents:\n\n| Field            | Admin | Editor | Author | Viewer |\n| ---------------- | ----- | ------ | ------ | ------ |\n| `title`          | ✅    | ✅     | ✅     | ✅     |\n| `content`        | ✅    | ✅     | ✅     | ✅     |\n| `status`         | ✅    | ✅     | ✅     | ✅     |\n| `isLocked`       | ✅    | ✅     | ✅     | ❌     |\n| `creatorId`      | ✅    | ✅     | ✅     | ❌     |\n| `lastEditedById` | ✅    | ✅     | ✅     | ❌     |\n| `createdAt`      | ✅    | ✅     | ✅     | ❌     |\n| `updatedAt`      | ✅    | ✅     | ✅     | ❌     |\n\n### 2. Field-Level Write Permissions\n\nWhen creating or editing documents, only certain fields should be writable:\n\n| Field      | Admin | Editor | Author |\n| ---------- | ----- | ------ | ------ |\n| `title`    | ✅    | ✅     | ✅     |\n| `content`  | ✅    | ✅     | ✅     |\n| `status`   | ✅    | ✅     | ❌     |\n| `isLocked` | ✅    | ❌     | ❌     |\n\nAuthors can write content but can't change document status or lock documents.\n\n### 3. 3. Environment-Based Rules\n\nSince this company values work-life balance, editors and authors are not allowed to make changes on weekends which is an example of an **environment-based** rule that uses attributes from neither the user nor the resource.\n\n## Extending the Permission API\n\nWe need to enhance our `can()` function to support field checks:\n\n```typescript\n// Check if user can read a specific field\npermissions.can(\"document\", \"read\", document, \"isLocked\")\n\n// Check if user can update a specific field\npermissions.can(\"document\", \"update\", document, \"status\")\n```\n\n## Enhanced Policy Definitions\n\nThe `allow` function now accepts an optional fields array as a fourth parameter:\n\n```typescript\nfunction addEditorPermissions(\n  builder: PermissionBuilder,\n  user: Pick\u003cUser, \"department\"\u003e,\n) {\n  builder.allow(\"document\", \"read\") // All fields by default\n\n  builder.allow(\n    \"document\",\n    \"update\",\n    { isLocked: false }, // Condition: only unlocked docs\n    [\"content\", \"title\", \"status\"], // Restricted to these fields\n  )\n}\n```\n\n## Updating the Permission Builder\n\nWe only need to change two things in our existing builder:\n\n### 1. Add `fields` to the `allow()` method\n\n```typescript\nallow\u003cRes extends keyof Resources\u003e(\n  resource: Res,\n  action: Resources[Res][\"action\"],\n  condition?: Partial\u003cResources[Res][\"condition\"]\u003e,\n  fields?: string[], // NEW: optional field restriction\n) {\n  this.#permissions[resource].push({ action, condition, fields })\n  return this\n}\n```\n\n### 2. Check fields in `can()`\n\nAdd this after the condition check passes:\n\n```typescript\n// Check field permission (new logic)\nif (field != null \u0026\u0026 perm.fields != null) {\n  return perm.fields.includes(field)\n}\n```\n\nThe full logic: if a field is requested AND this permission specifies allowed fields, check if the field is in the list. If `perm.fields` is `null`, all fields are allowed.\n\n## Using Field Permissions\n\nAdding support for field permissions takes a little bit of TypeScript wizardry and extra work, but for the most part isn't too bad. Where field permissions become difficult to work with is when consuming which fields a user has access to and ensuring your UI works for all possible permutations.\n\n### In Forms\n\nWe compute which fields the user can modify, then pass that info to the form component:\n\n```tsx\n// Edit document page\nconst permissions = getUserPermissions(user)\n\n\u003cDocumentForm\n  document={document}\n  projectId={projectId}\n  canModify={{\n    status: permissions.can(\"document\", \"update\", document, \"status\"),\n    isLocked: permissions.can(\"document\", \"update\", document, \"isLocked\"),\n  }}\n/\u003e\n```\n\nWhy pass `canModify` as a prop instead of checking permissions inside the form? This keeps the form component **pure** since it just renders based on props, making it easier to test and reuse. It also ensures these components are easier to test and reuse.\n\n### In the Form Component\n\nThe form conditionally renders fields based on permissions:\n\n```tsx\nfunction DocumentForm({ document, projectId, canModify }) {\n  return (\n    \u003cForm\u003e\n      \u003cInput name=\"title\" /\u003e\n      \u003cTextarea name=\"content\" /\u003e\n\n      {canModify.status \u0026\u0026 (\n        \u003cSelect name=\"status\"\u003e\n          \u003coption value=\"draft\"\u003eDraft\u003c/option\u003e\n          \u003coption value=\"published\"\u003ePublished\u003c/option\u003e\n          \u003coption value=\"archived\"\u003eArchived\u003c/option\u003e\n        \u003c/Select\u003e\n      )}\n\n      {canModify.isLocked \u0026\u0026 \u003cCheckbox name=\"isLocked\" label=\"Lock document\" /\u003e}\n    \u003c/Form\u003e\n  )\n}\n```\n\n### In Display Components\n\nFor read permissions, we hide fields the user can't see:\n\n```typescript\n// Document detail page\nconst permissions = getUserPermissions(user)\n\nconst canReadField = {\n  isLocked: permissions.can(\"document\", \"read\", document, \"isLocked\"),\n  creator: permissions.can(\"document\", \"read\", document, \"creatorId\"),\n}\n\n// In JSX\n{canReadField.isLocked \u0026\u0026 document.isLocked \u0026\u0026 (\n  \u003cBadge\u003eLocked\u003c/Badge\u003e\n)}\n\n{canReadField.creator \u0026\u0026 (\n  \u003cdiv\u003eCreated by: {document.creator.name}\u003c/div\u003e\n)}\n```\n\n## Filtering Permitted Fields\n\nWhen handling form submissions, we need to filter out fields the user isn't allowed to modify, even if they try to send them from the client:\n\n```typescript\nfunction pickPermittedFields\u003cT extends Record\u003cstring, unknown\u003e\u003e(\n  permissions: ReturnType\u003ctypeof getUserPermissions\u003e,\n  resource: keyof Resources,\n  action: string,\n  data: T,\n  resourceData?: Resources[keyof Resources][\"condition\"],\n): Partial\u003cT\u003e {\n  const result: Record\u003cstring, unknown\u003e = {}\n\n  for (const [key, value] of Object.entries(data)) {\n    if (permissions.can(resource, action, resourceData, key)) {\n      result[key] = value\n    }\n  }\n\n  return result as Partial\u003cT\u003e\n}\n```\n\nThis is useful during mutations since it ensures security even if someone bypasses the UI:\n\n```typescript\nconst restrictedData = pickPermittedFields(\n  permissions,\n  \"document\",\n  \"update\",\n  formData,\n  existingDocument,\n)\n// restrictedData only contains fields the user can actually modify\n```\n\n## Implementing Environment Rules\n\nFor weekend restrictions, we check the current day when building permissions:\n\n```typescript\nfunction addEditorPermissions(\n  builder: PermissionBuilder,\n  user: Pick\u003cUser, \"department\"\u003e,\n) {\n  const dayOfWeek = new Date().getDay()\n  const isWeekend = dayOfWeek === 0 || dayOfWeek === 6\n\n  builder\n    .allow(\"project\", \"read\", { department: user.department })\n    .allow(\"project\", \"read\", { department: null })\n    .allow(\"document\", \"read\")\n\n  // Only allow updates on weekdays\n  if (!isWeekend) {\n    builder.allow(\"document\", \"update\", { isLocked: false })\n  }\n}\n```\n\nThe permission decision can incorporate **any** attribute: user, resource, or environment.\n\n## The Power of ABAC\n\nNotice what we can now express:\n\n```typescript\n// \"Authors can read the createdAt field only on documents they created\"\npermissions.can(\"document\", \"read\", { creatorId: user.id }, \"createdAt\")\n\n// \"Editors can update status on unlocked documents\"\npermissions.can(\"document\", \"update\", { isLocked: false }, \"status\")\n```\n\nThese complex, conditional, field-level permissions are natural in ABAC but would require an explosion of permission strings in RBAC.\n\n## What's Next\n\nOur ABAC system is powerful, but we still have permission checks scattered throughout:\n\n- Page components\n- Server actions\n- Mutations\n- Query functions\n\nIn the next lesson, we'll create a **services layer** that centralizes all authorization logic and even converts permissions to database queries automatically.\n","slug":"advanced-abac-features","title":"Advanced ABAC Features","section":"Attribute-Based Access Control (ABAC)","icon":"cog","filePath":"/home/runner/work/fem-permission-systems-that-scale/fem-permission-systems-that-scale/lessons/04-abac/C-advanced-abac-features.md","nextSlug":"/fem-permission-systems-that-scale/lessons/abac/clean-architecture-services","prevSlug":"/fem-permission-systems-that-scale/lessons/abac/converting-to-abac"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"abac","slug":"advanced-abac-features"},"buildId":"Z1s-VsOExbnNujkBZEKnx","assetPrefix":"/fem-permission-systems-that-scale","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>