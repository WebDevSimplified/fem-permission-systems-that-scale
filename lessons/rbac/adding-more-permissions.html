<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/fem-permission-systems-that-scale/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/fem-permission-systems-that-scale/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/fem-permission-systems-that-scale/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/fem-permission-systems-that-scale/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/fem-permission-systems-that-scale/images/favicon.ico" data-next-head=""/><title data-next-head="">Adding More Permissions – Permission Systems that Scale</title><meta name="description" content="Learn how to implement robust permission systems in your web applications. Master RBAC, ABAC, field-level permissions, and build your own authorization engine from scratch using TypeScript." data-next-head=""/><meta name="keywords" content="Permissions,Authorization,RBAC,ABAC,Access Control,TypeScript,Security,CASL,Web Dev Simplified,Frontend Masters" data-next-head=""/><meta name="og:description" content="Learn how to implement robust permission systems in your web applications. Master RBAC, ABAC, field-level permissions, and build your own authorization engine from scratch using TypeScript." data-next-head=""/><meta name="og:title" content="Adding More Permissions – Permission Systems that Scale" data-next-head=""/><meta name="og:image" content="/fem-permission-systems-that-scale/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/fem-permission-systems-that-scale/_next/static/css/3e2d260a483e4ce6.css" as="style"/><link rel="stylesheet" href="/fem-permission-systems-that-scale/_next/static/css/3e2d260a483e4ce6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/fem-permission-systems-that-scale/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/webpack-561d6b920ac5fc2e.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/main-8377b0572add80b6.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/pages/_app-ab9f88be91011ccd.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-c23b0a3ff434a742.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/Z1s-VsOExbnNujkBZEKnx/_buildManifest.js" defer=""></script><script src="/fem-permission-systems-that-scale/_next/static/Z1s-VsOExbnNujkBZEKnx/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/fem-permission-systems-that-scale">Permission Systems that Scale</a></h1><div class="navbar-info"></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>Our RBAC system works great—until the business asks for &quot;just a few more rules.&quot; Let&#39;s add some realistic permission requirements and see how RBAC handles them.</p>
<h2>New Permission Requirements</h2>
<p>Our system is currently very bare-bones and a more realistic set of permissions may include the following:</p>
<h3>1. Locked Documents</h3>
<p>Documents can be <strong>locked</strong> to prevent editing. Only admins can edit locked documents.</p>
<h3>2. Draft Visibility</h3>
<p><strong>Draft documents</strong> should only be visible to:</p>
<ul>
<li>The document creator (authors can see their own drafts)</li>
<li>Editors and admins (they can see all drafts)</li>
<li>Viewers should <strong>not</strong> see drafts</li>
</ul>
<h3>3. Author Edit Restrictions</h3>
<p>Authors should only be able to edit:</p>
<ul>
<li>Documents <strong>they created</strong></li>
<li>That are <strong>not locked</strong></li>
<li>That are still in <strong>draft status</strong></li>
</ul>
<p>Once a document is published, only editors and admins can modify it.</p>
<h3>Full Permission Matrix</h3>
<p>Here&#39;s the complete permission matrix we need to implement:</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Admin</th>
<th>Editor</th>
<th>Author</th>
<th>Viewer</th>
</tr>
</thead>
<tbody><tr>
<td><strong>View</strong> published/archived docs</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><strong>View</strong> draft docs (any)</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td><strong>View</strong> draft docs (own)</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><strong>Edit</strong> unlocked docs</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td><strong>Edit</strong> own unlocked draft docs</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><strong>Edit</strong> locked docs</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td><strong>Delete</strong> docs</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td><strong>Create</strong> docs</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
</tr>
</tbody></table>
<h2>The Problem Emerges</h2>
<p>Look at the &quot;Author Edit&quot; requirement again:</p>
<blockquote>
<p>Authors can edit documents <strong>they created</strong>, that are <strong>not locked</strong>, in <strong>draft status</strong></p>
</blockquote>
<p>This permission depends on:</p>
<ul>
<li>The <strong>user&#39;s role</strong> (must be author)</li>
<li>The <strong>user&#39;s ID</strong> (must be the creator)</li>
<li>The <strong>document&#39;s isLocked</strong> attribute</li>
<li>The <strong>document&#39;s status</strong> attribute</li>
</ul>
<p>Pure RBAC struggles to express this. We need to check <strong>attributes</strong> of both the user and the resource.</p>
<h2>Attempting RBAC Solutions</h2>
<p>To solve this in RBAC, we need to create very specific permissions:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">type</span> <span class="hljs-title class_">Permission</span> =
  <span class="hljs-comment">// ...existing permissions...</span>
  | <span class="hljs-string">&quot;document:update:unlocked&quot;</span>
  | <span class="hljs-string">&quot;document:update:own-unlocked-draft&quot;</span>
  | <span class="hljs-string">&quot;document:read:all&quot;</span>
  | <span class="hljs-string">&quot;document:read:own&quot;</span>
  | <span class="hljs-string">&quot;document:read:non-draft&quot;</span>
</code></pre><p>Then assign them to roles:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">const</span> permissionsByRole = {
  <span class="hljs-attr">admin</span>: [
    <span class="hljs-string">&quot;document:update:unlocked&quot;</span>, <span class="hljs-comment">// Can edit any unlocked doc</span>
    <span class="hljs-string">&quot;document:read:all&quot;</span>,
    <span class="hljs-comment">// ...</span>
  ],
  <span class="hljs-attr">author</span>: [
    <span class="hljs-string">&quot;document:update:own-unlocked-draft&quot;</span>, <span class="hljs-comment">// Very specific!</span>
    <span class="hljs-string">&quot;document:read:own&quot;</span>,
    <span class="hljs-string">&quot;document:read:non-draft&quot;</span>,
    <span class="hljs-comment">// ...</span>
  ],
  <span class="hljs-comment">// ...</span>
}
</code></pre><p>But now we need helper functions to use these effectively:</p>
<pre><code class="hljs language-typescript"><button class="copy-btn">Copy</button><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">canUpdateDocument</span>(<span class="hljs-params">
  <span class="hljs-attr">user</span>: <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">&quot;role&quot;</span> | <span class="hljs-string">&quot;id&quot;</span>&gt; | <span class="hljs-literal">null</span>,
  <span class="hljs-attr">document</span>: <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">Document</span>, <span class="hljs-string">&quot;creatorId&quot;</span> | <span class="hljs-string">&quot;status&quot;</span> | <span class="hljs-string">&quot;isLocked&quot;</span>&gt;,
</span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// Admins/editors: can edit any unlocked document</span>
    (<span class="hljs-title function_">can</span>(user, <span class="hljs-string">&quot;document:update:unlocked&quot;</span>) &amp;&amp; !<span class="hljs-variable language_">document</span>.<span class="hljs-property">isLocked</span>) ||
    <span class="hljs-comment">// Authors: only their own, unlocked, draft documents</span>
    (<span class="hljs-title function_">can</span>(user, <span class="hljs-string">&quot;document:update:own-unlocked-draft&quot;</span>) &amp;&amp;
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">creatorId</span> === user.<span class="hljs-property">id</span> &amp;&amp;
      !<span class="hljs-variable language_">document</span>.<span class="hljs-property">isLocked</span> &amp;&amp;
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">status</span> === <span class="hljs-string">&quot;draft&quot;</span>)
  )
}
</code></pre><h2>What Went Wrong?</h2>
<p>Notice the problems:</p>
<h3>1. Permissions Exploded In Complexity</h3>
<p>We now have 3 permissions to read a document, 2 for updating, and 3 for reading a project. This problem also grows exponentially as more attributes and conditions are added since if we needed to check just 2 more attributes on a document we would need to create permissions for every permutation of those attributes.</p>
<h3>2. Logic Scattered Again</h3>
<p>Our simple <code>can</code> function is no longer able to handle complex permission checks on its own which leads to many helper functions that are complex and easy to misuse.</p>
<h3>3. Database Queries Duplicate Permissions</h3>
<p>With the current RBAC implementation, we need to essentially rewrite each permission check into its corresponding database query when querying multiple items (such as getting all the projects that user has access to). This leads to duplicated logic between the permission system code and the database layer, making it harder to maintain and increasing the risk of inconsistencies.</p>
<h2>Branch Checkpoint</h2>
<p>After adding these permissions, your code should match:</p>
<pre><code class="hljs language-text"><button class="copy-btn">Copy</button>Branch: 4-rbac-limits
</code></pre><p>Run the following to sync up:</p>
<pre><code class="hljs language-bash"><button class="copy-btn">Copy</button>git checkout 4-rbac-limits
</code></pre></div><div class="lesson-links"><a href="/fem-permission-systems-that-scale/lessons/rbac/converting-to-rbac" class="prev">← Previous</a><a href="/fem-permission-systems-that-scale/lessons/rbac/rbac-limitations" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/DevSimplified"><svg fill="none" height="100%" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://github.com/WebDevSimplified"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul><div class="theme-icons"><button aria-label="Activate dark mode" title="Activate dark mode" class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="36px" height="100%" viewBox="0 -960 960 960" fill="var(--text-footer)" role="img"><title>Dark Mode Icon</title><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Z"></path></svg></button></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"title":"Adding More Permissions"},"html":"\u003cp\u003eOur RBAC system works great—until the business asks for \u0026quot;just a few more rules.\u0026quot; Let\u0026#39;s add some realistic permission requirements and see how RBAC handles them.\u003c/p\u003e\n\u003ch2\u003eNew Permission Requirements\u003c/h2\u003e\n\u003cp\u003eOur system is currently very bare-bones and a more realistic set of permissions may include the following:\u003c/p\u003e\n\u003ch3\u003e1. Locked Documents\u003c/h3\u003e\n\u003cp\u003eDocuments can be \u003cstrong\u003elocked\u003c/strong\u003e to prevent editing. Only admins can edit locked documents.\u003c/p\u003e\n\u003ch3\u003e2. Draft Visibility\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eDraft documents\u003c/strong\u003e should only be visible to:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe document creator (authors can see their own drafts)\u003c/li\u003e\n\u003cli\u003eEditors and admins (they can see all drafts)\u003c/li\u003e\n\u003cli\u003eViewers should \u003cstrong\u003enot\u003c/strong\u003e see drafts\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e3. Author Edit Restrictions\u003c/h3\u003e\n\u003cp\u003eAuthors should only be able to edit:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDocuments \u003cstrong\u003ethey created\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eThat are \u003cstrong\u003enot locked\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eThat are still in \u003cstrong\u003edraft status\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOnce a document is published, only editors and admins can modify it.\u003c/p\u003e\n\u003ch3\u003eFull Permission Matrix\u003c/h3\u003e\n\u003cp\u003eHere\u0026#39;s the complete permission matrix we need to implement:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eAction\u003c/th\u003e\n\u003cth\u003eAdmin\u003c/th\u003e\n\u003cth\u003eEditor\u003c/th\u003e\n\u003cth\u003eAuthor\u003c/th\u003e\n\u003cth\u003eViewer\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eView\u003c/strong\u003e published/archived docs\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eView\u003c/strong\u003e draft docs (any)\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eView\u003c/strong\u003e draft docs (own)\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eEdit\u003c/strong\u003e unlocked docs\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eEdit\u003c/strong\u003e own unlocked draft docs\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eEdit\u003c/strong\u003e locked docs\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eDelete\u003c/strong\u003e docs\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eCreate\u003c/strong\u003e docs\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003ctd\u003e❌\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch2\u003eThe Problem Emerges\u003c/h2\u003e\n\u003cp\u003eLook at the \u0026quot;Author Edit\u0026quot; requirement again:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAuthors can edit documents \u003cstrong\u003ethey created\u003c/strong\u003e, that are \u003cstrong\u003enot locked\u003c/strong\u003e, in \u003cstrong\u003edraft status\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis permission depends on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003cstrong\u003euser\u0026#39;s role\u003c/strong\u003e (must be author)\u003c/li\u003e\n\u003cli\u003eThe \u003cstrong\u003euser\u0026#39;s ID\u003c/strong\u003e (must be the creator)\u003c/li\u003e\n\u003cli\u003eThe \u003cstrong\u003edocument\u0026#39;s isLocked\u003c/strong\u003e attribute\u003c/li\u003e\n\u003cli\u003eThe \u003cstrong\u003edocument\u0026#39;s status\u003c/strong\u003e attribute\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ePure RBAC struggles to express this. We need to check \u003cstrong\u003eattributes\u003c/strong\u003e of both the user and the resource.\u003c/p\u003e\n\u003ch2\u003eAttempting RBAC Solutions\u003c/h2\u003e\n\u003cp\u003eTo solve this in RBAC, we need to create very specific permissions:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePermission\u003c/span\u003e =\n  \u003cspan class=\"hljs-comment\"\u003e// ...existing permissions...\u003c/span\u003e\n  | \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:update:unlocked\u0026quot;\u003c/span\u003e\n  | \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:update:own-unlocked-draft\u0026quot;\u003c/span\u003e\n  | \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:read:all\u0026quot;\u003c/span\u003e\n  | \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:read:own\u0026quot;\u003c/span\u003e\n  | \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:read:non-draft\u0026quot;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThen assign them to roles:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e permissionsByRole = {\n  \u003cspan class=\"hljs-attr\"\u003eadmin\u003c/span\u003e: [\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:update:unlocked\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Can edit any unlocked doc\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:read:all\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  ],\n  \u003cspan class=\"hljs-attr\"\u003eauthor\u003c/span\u003e: [\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:update:own-unlocked-draft\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Very specific!\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:read:own\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:read:non-draft\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  ],\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eBut now we need helper functions to use these effectively:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecanUpdateDocument\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\n  \u003cspan class=\"hljs-attr\"\u003euser\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePick\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;role\u0026quot;\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\u0026quot;id\u0026quot;\u003c/span\u003e\u0026gt; | \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003edocument\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003ePick\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title class_\"\u003eDocument\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;creatorId\u0026quot;\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\u0026quot;status\u0026quot;\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\u0026quot;isLocked\u0026quot;\u003c/span\u003e\u0026gt;,\n\u003c/span\u003e): \u003cspan class=\"hljs-built_in\"\u003eboolean\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (user == \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"hljs-comment\"\u003e// Admins/editors: can edit any unlocked document\u003c/span\u003e\n    (\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(user, \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:update:unlocked\u0026quot;\u003c/span\u003e) \u0026amp;\u0026amp; !\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eisLocked\u003c/span\u003e) ||\n    \u003cspan class=\"hljs-comment\"\u003e// Authors: only their own, unlocked, draft documents\u003c/span\u003e\n    (\u003cspan class=\"hljs-title function_\"\u003ecan\u003c/span\u003e(user, \u003cspan class=\"hljs-string\"\u003e\u0026quot;document:update:own-unlocked-draft\u0026quot;\u003c/span\u003e) \u0026amp;\u0026amp;\n      \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecreatorId\u003c/span\u003e === user.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e \u0026amp;\u0026amp;\n      !\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eisLocked\u003c/span\u003e \u0026amp;\u0026amp;\n      \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003estatus\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026quot;draft\u0026quot;\u003c/span\u003e)\n  )\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eWhat Went Wrong?\u003c/h2\u003e\n\u003cp\u003eNotice the problems:\u003c/p\u003e\n\u003ch3\u003e1. Permissions Exploded In Complexity\u003c/h3\u003e\n\u003cp\u003eWe now have 3 permissions to read a document, 2 for updating, and 3 for reading a project. This problem also grows exponentially as more attributes and conditions are added since if we needed to check just 2 more attributes on a document we would need to create permissions for every permutation of those attributes.\u003c/p\u003e\n\u003ch3\u003e2. Logic Scattered Again\u003c/h3\u003e\n\u003cp\u003eOur simple \u003ccode\u003ecan\u003c/code\u003e function is no longer able to handle complex permission checks on its own which leads to many helper functions that are complex and easy to misuse.\u003c/p\u003e\n\u003ch3\u003e3. Database Queries Duplicate Permissions\u003c/h3\u003e\n\u003cp\u003eWith the current RBAC implementation, we need to essentially rewrite each permission check into its corresponding database query when querying multiple items (such as getting all the projects that user has access to). This leads to duplicated logic between the permission system code and the database layer, making it harder to maintain and increasing the risk of inconsistencies.\u003c/p\u003e\n\u003ch2\u003eBranch Checkpoint\u003c/h2\u003e\n\u003cp\u003eAfter adding these permissions, your code should match:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003eBranch: 4-rbac-limits\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eRun the following to sync up:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cbutton class=\"copy-btn\"\u003eCopy\u003c/button\u003egit checkout 4-rbac-limits\n\u003c/code\u003e\u003c/pre\u003e","markdown":"\nOur RBAC system works great—until the business asks for \"just a few more rules.\" Let's add some realistic permission requirements and see how RBAC handles them.\n\n## New Permission Requirements\n\nOur system is currently very bare-bones and a more realistic set of permissions may include the following:\n\n### 1. Locked Documents\n\nDocuments can be **locked** to prevent editing. Only admins can edit locked documents.\n\n### 2. Draft Visibility\n\n**Draft documents** should only be visible to:\n\n- The document creator (authors can see their own drafts)\n- Editors and admins (they can see all drafts)\n- Viewers should **not** see drafts\n\n### 3. Author Edit Restrictions\n\nAuthors should only be able to edit:\n\n- Documents **they created**\n- That are **not locked**\n- That are still in **draft status**\n\nOnce a document is published, only editors and admins can modify it.\n\n### Full Permission Matrix\n\nHere's the complete permission matrix we need to implement:\n\n| Action                           | Admin | Editor | Author | Viewer |\n| -------------------------------- | ----- | ------ | ------ | ------ |\n| **View** published/archived docs | ✅    | ✅     | ✅     | ✅     |\n| **View** draft docs (any)        | ✅    | ✅     | ❌     | ❌     |\n| **View** draft docs (own)        | ✅    | ✅     | ✅     | ❌     |\n| **Edit** unlocked docs           | ✅    | ✅     | ❌     | ❌     |\n| **Edit** own unlocked draft docs | ✅    | ✅     | ✅     | ❌     |\n| **Edit** locked docs             | ✅    | ❌     | ❌     | ❌     |\n| **Delete** docs                  | ✅    | ❌     | ❌     | ❌     |\n| **Create** docs                  | ✅    | ❌     | ✅     | ❌     |\n\n## The Problem Emerges\n\nLook at the \"Author Edit\" requirement again:\n\n\u003e Authors can edit documents **they created**, that are **not locked**, in **draft status**\n\nThis permission depends on:\n\n- The **user's role** (must be author)\n- The **user's ID** (must be the creator)\n- The **document's isLocked** attribute\n- The **document's status** attribute\n\nPure RBAC struggles to express this. We need to check **attributes** of both the user and the resource.\n\n## Attempting RBAC Solutions\n\nTo solve this in RBAC, we need to create very specific permissions:\n\n```typescript\ntype Permission =\n  // ...existing permissions...\n  | \"document:update:unlocked\"\n  | \"document:update:own-unlocked-draft\"\n  | \"document:read:all\"\n  | \"document:read:own\"\n  | \"document:read:non-draft\"\n```\n\nThen assign them to roles:\n\n```typescript\nconst permissionsByRole = {\n  admin: [\n    \"document:update:unlocked\", // Can edit any unlocked doc\n    \"document:read:all\",\n    // ...\n  ],\n  author: [\n    \"document:update:own-unlocked-draft\", // Very specific!\n    \"document:read:own\",\n    \"document:read:non-draft\",\n    // ...\n  ],\n  // ...\n}\n```\n\nBut now we need helper functions to use these effectively:\n\n```typescript\nexport function canUpdateDocument(\n  user: Pick\u003cUser, \"role\" | \"id\"\u003e | null,\n  document: Pick\u003cDocument, \"creatorId\" | \"status\" | \"isLocked\"\u003e,\n): boolean {\n  if (user == null) return false\n\n  return (\n    // Admins/editors: can edit any unlocked document\n    (can(user, \"document:update:unlocked\") \u0026\u0026 !document.isLocked) ||\n    // Authors: only their own, unlocked, draft documents\n    (can(user, \"document:update:own-unlocked-draft\") \u0026\u0026\n      document.creatorId === user.id \u0026\u0026\n      !document.isLocked \u0026\u0026\n      document.status === \"draft\")\n  )\n}\n```\n\n## What Went Wrong?\n\nNotice the problems:\n\n### 1. Permissions Exploded In Complexity\n\nWe now have 3 permissions to read a document, 2 for updating, and 3 for reading a project. This problem also grows exponentially as more attributes and conditions are added since if we needed to check just 2 more attributes on a document we would need to create permissions for every permutation of those attributes.\n\n### 2. Logic Scattered Again\n\nOur simple `can` function is no longer able to handle complex permission checks on its own which leads to many helper functions that are complex and easy to misuse.\n\n### 3. Database Queries Duplicate Permissions\n\nWith the current RBAC implementation, we need to essentially rewrite each permission check into its corresponding database query when querying multiple items (such as getting all the projects that user has access to). This leads to duplicated logic between the permission system code and the database layer, making it harder to maintain and increasing the risk of inconsistencies.\n\n## Branch Checkpoint\n\nAfter adding these permissions, your code should match:\n\n```text\nBranch: 4-rbac-limits\n```\n\nRun the following to sync up:\n\n```bash\ngit checkout 4-rbac-limits\n```\n","slug":"adding-more-permissions","title":"Adding More Permissions","section":"Role-Based Access Control (RBAC)","icon":"shield","filePath":"/home/runner/work/fem-permission-systems-that-scale/fem-permission-systems-that-scale/lessons/03-rbac/C-adding-more-permissions.md","nextSlug":"/fem-permission-systems-that-scale/lessons/rbac/rbac-limitations","prevSlug":"/fem-permission-systems-that-scale/lessons/rbac/converting-to-rbac"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"rbac","slug":"adding-more-permissions"},"buildId":"Z1s-VsOExbnNujkBZEKnx","assetPrefix":"/fem-permission-systems-that-scale","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>