{"pageProps":{"post":{"attributes":{"title":"Common Permission Mistakes"},"html":"<p>Before we implement a proper permission system, let&#39;s identify the problems in our current codebase. These issues are extremely common in real-world applications—you&#39;ve likely seen (or written!) code with these same mistakes.</p>\n<h2>The Three Cardinal Sins of Permissions</h2>\n<p>Our demo app currently suffers from three major permission problems:</p>\n<table>\n<thead>\n<tr>\n<th>Problem</th>\n<th>Description</th>\n<th>Risk Level</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Scattered checks</strong></td>\n<td>Permission logic duplicated across files</td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>Missing server checks</strong></td>\n<td>Permissions only validated on the client</td>\n<td>Critical</td>\n</tr>\n<tr>\n<td><strong>Inconsistent logic</strong></td>\n<td>Same permission checked differently in different places</td>\n<td>High</td>\n</tr>\n</tbody></table>\n<h2>Problem 1: Scattered Permission Checks</h2>\n<p>Look at our current codebase. Permission checks are sprinkled throughout:</p>\n<ul>\n<li>Page components (checking if buttons should render)</li>\n<li>Server actions (checking if operations should proceed)</li>\n<li>Route handlers (checking access to pages)</li>\n</ul>\n<p>When the same logic exists in multiple places, bugs are inevitable. A developer updates the permission logic in one place but forgets the others. Now you have inconsistent behavior that&#39;s incredibly hard to debug.</p>\n<blockquote>\n<p>⚠️ <strong>Real-world example</strong>: A common bug is allowing a user to access an &quot;Edit&quot; page but blocking them from actually saving changes. Or worse—blocking the UI button but not the API endpoint, so a savvy user can still perform unauthorized actions via the browser console.</p>\n</blockquote>\n<h2>Problem 2: Missing Server-Side Checks</h2>\n<p>This is the most dangerous mistake. Our current app has pages that can be accessed by <strong>anyone who knows the URL</strong>, even if the UI doesn&#39;t show a link to that page.</p>\n<p>For example, if you&#39;re logged in as a <code>viewer</code> and manually navigate to:</p>\n<pre><code class=\"hljs language-text\"><button class=\"copy-btn\">Copy</button>/projects/[projectId]/documents/[documentId]\n</code></pre><p>You can access that page (even if you normally wouldn&#39;t be able to see that document)</p>\n<p><strong>The golden rule</strong>: Never trust the client. If a permission matters, check it on the server.</p>\n<h2>Problem 3: Inconsistent Permission Logic</h2>\n<p>Our permission checks are complex and hard to read. Consider checking if a user can access a project:</p>\n<pre><code class=\"hljs language-typescript\"><button class=\"copy-btn\">Copy</button><span class=\"hljs-comment\">// This check appears in multiple places</span>\n<span class=\"hljs-keyword\">if</span> (\n  user.<span class=\"hljs-property\">role</span> !== <span class=\"hljs-string\">&quot;admin&quot;</span> &amp;&amp;\n  project.<span class=\"hljs-property\">department</span> != <span class=\"hljs-literal\">null</span> &amp;&amp;\n  user.<span class=\"hljs-property\">department</span> !== project.<span class=\"hljs-property\">department</span>\n) {\n  <span class=\"hljs-comment\">// deny access</span>\n}\n</code></pre><p>This logic is:</p>\n<ul>\n<li><strong>Duplicated</strong> across multiple files</li>\n<li><strong>Error-prone</strong> (easy to miss a condition)</li>\n<li><strong>Hard to read</strong> (what does this actually check?)</li>\n<li><strong>Inconsistent</strong> (some places might check slightly differently)</li>\n</ul>\n<h2>Why This Matters</h2>\n<p>These issues compound over time:</p>\n<ol>\n<li><strong>Security vulnerabilities</strong> - Missing checks = unauthorized access</li>\n<li><strong>Maintenance nightmare</strong> - Changing permission logic requires updating many files</li>\n<li><strong>Testing difficulty</strong> - Hard to verify all permission paths work correctly</li>\n<li><strong>Onboarding friction</strong> - New developers don&#39;t know where all the checks live</li>\n</ol>\n<h2>Our Goals for This Section</h2>\n<p>By the end of this section, we&#39;ll:</p>\n<ol>\n<li>Add missing server-side permission checks to all pages</li>\n<li>Identify places where permission logic is inconsistent</li>\n<li>Recognize the need to centralize this logic (which we&#39;ll do properly in later sections)</li>\n</ol>\n<p>Let&#39;s start by finding and fixing the missing checks in our application.</p>\n","markdown":"\nBefore we implement a proper permission system, let's identify the problems in our current codebase. These issues are extremely common in real-world applications—you've likely seen (or written!) code with these same mistakes.\n\n## The Three Cardinal Sins of Permissions\n\nOur demo app currently suffers from three major permission problems:\n\n| Problem                   | Description                                             | Risk Level |\n| ------------------------- | ------------------------------------------------------- | ---------- |\n| **Scattered checks**      | Permission logic duplicated across files                | High       |\n| **Missing server checks** | Permissions only validated on the client                | Critical   |\n| **Inconsistent logic**    | Same permission checked differently in different places | High       |\n\n## Problem 1: Scattered Permission Checks\n\nLook at our current codebase. Permission checks are sprinkled throughout:\n\n- Page components (checking if buttons should render)\n- Server actions (checking if operations should proceed)\n- Route handlers (checking access to pages)\n\nWhen the same logic exists in multiple places, bugs are inevitable. A developer updates the permission logic in one place but forgets the others. Now you have inconsistent behavior that's incredibly hard to debug.\n\n> ⚠️ **Real-world example**: A common bug is allowing a user to access an \"Edit\" page but blocking them from actually saving changes. Or worse—blocking the UI button but not the API endpoint, so a savvy user can still perform unauthorized actions via the browser console.\n\n## Problem 2: Missing Server-Side Checks\n\nThis is the most dangerous mistake. Our current app has pages that can be accessed by **anyone who knows the URL**, even if the UI doesn't show a link to that page.\n\nFor example, if you're logged in as a `viewer` and manually navigate to:\n\n```text\n/projects/[projectId]/documents/[documentId]\n```\n\nYou can access that page (even if you normally wouldn't be able to see that document)\n\n**The golden rule**: Never trust the client. If a permission matters, check it on the server.\n\n## Problem 3: Inconsistent Permission Logic\n\nOur permission checks are complex and hard to read. Consider checking if a user can access a project:\n\n```typescript\n// This check appears in multiple places\nif (\n  user.role !== \"admin\" &&\n  project.department != null &&\n  user.department !== project.department\n) {\n  // deny access\n}\n```\n\nThis logic is:\n\n- **Duplicated** across multiple files\n- **Error-prone** (easy to miss a condition)\n- **Hard to read** (what does this actually check?)\n- **Inconsistent** (some places might check slightly differently)\n\n## Why This Matters\n\nThese issues compound over time:\n\n1. **Security vulnerabilities** - Missing checks = unauthorized access\n2. **Maintenance nightmare** - Changing permission logic requires updating many files\n3. **Testing difficulty** - Hard to verify all permission paths work correctly\n4. **Onboarding friction** - New developers don't know where all the checks live\n\n## Our Goals for This Section\n\nBy the end of this section, we'll:\n\n1. Add missing server-side permission checks to all pages\n2. Identify places where permission logic is inconsistent\n3. Recognize the need to centralize this logic (which we'll do properly in later sections)\n\nLet's start by finding and fixing the missing checks in our application.\n","slug":"common-permission-mistakes","title":"Common Permission Mistakes","section":"Fixing Basic Permissions","icon":"wrench","filePath":"/home/runner/work/fem-permission-systems-that-scale/fem-permission-systems-that-scale/lessons/02-fixing-basic-permissions/A-common-permission-mistakes.md","nextSlug":"/fem-permission-systems-that-scale/lessons/fixing-basic-permissions/fixing-basic-permissions","prevSlug":"/fem-permission-systems-that-scale/lessons/introduction/project-overview"}},"__N_SSG":true}